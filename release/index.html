<!DOCTYPE html>

<html>
    <head>
        <link rel="icon" href="https://www.autohotkey.com/favicon.ico" type="image/x-icon"/>
        <meta charset="UTF-8">
        <title>$title</title>        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-ui@2.13.2/lib/theme-chalk/index.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css">
        <style>
            [v-cloak] {
                display: none;
            }
            code, kbd {
                margin-left:0.5em;
                margin-right: 0.5em;
            }
            textarea{
                overflow: hidden;
            }

            ul.features {
                padding-inline-start: 0px;
            }
        </style>
    </head>

    <body>
        <div id="app" v-cloak>
            <el-container class="container">
                <el-header class="mt-3">
                    <h1>
                        $title
                        <small class="text-muted h6">ç‰ˆæœ¬:$version</small>
                    </h1>
                </el-header>
                <el-container>
                    <el-main>
                        <el-card header="å®‰è£…">
                        <p>
                            ä¸‹è½½å®‰è£… <a href="https://www.autohotkey.com/download/ahk-install.exe" download>AutoHotKey</a>
                        </p>
                        </el-card>
                        <el-card header="ä½¿ç”¨" class="mt-3">
                            <ol>
                                <li>åŒå‡»è¿è¡Œ<code>$exe</code>æ¥å¯åŠ¨è„šæœ¬</li>
                                <li>é€‰æ‹©ä¸€ä¸ªæµç¨‹æ–‡ä»¶</li>
                                <li>ä½¿ç”¨<kbd>F4</kbd>é”®å¼€å§‹æˆ–ç»“æŸæµç¨‹</li>
                            </ol>
                        </el-card>
                        <el-card header="åˆ¶ä½œæµç¨‹æ–‡ä»¶" class="mt-3">
                            <p>æ–°å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶æ¥åˆ¶ä½œä½ çš„ä»»åŠ¡æµç¨‹</p>
                            <p>æ–‡æœ¬ä¸­çš„æ¯ä¸€è¡Œä»£è¡¨ä¸€é¡¹ä»»åŠ¡</p>
                            <p>æ¯é¡¹ä»»åŠ¡åŒ…å«ä¸€ä¸ªæŒ‰é”®å’Œä¸€ä¸ªç­‰å¾…æ—¶é—´ï¼Œç”¨<code>|</code>åˆ†éš”</p>
                            <p>ä¾‹å¦‚</p>
                            <el-input
                                type="textarea"
                                autosize
                                readonly
                                :value="example"
                                class="mb-1"
                            >
                            </el-input>
                            <span>ä»£è¡¨</span>
                            <ol>
                                <li>æŒ‰ä¸‹<kbd>Numpad0</kbd>ç­‰å¾…2.5ç§’</li>
                                <li>æŒ‰ä¸‹<kbd>Numpad0</kbd>ç­‰å¾…2.5ç§’</li>
                                <li>æŒ‰ä¸‹<kbd>Numpad0</kbd>ç­‰å¾…2.5ç§’</li>
                                <li>æŒ‰ä¸‹<kbd>1</kbd>ç­‰å¾…40ç§’</li>
                                <li>å›åˆ°æ­¥éª¤1æŒç»­å¾ªç¯ç›´åˆ°å†æ¬¡æŒ‰ä¸‹<kbd>F4</kbd>ç»“æŸæµç¨‹</li>
                            </ol>
                        </el-card>
                        <el-card header="åˆ‡æ¢æµç¨‹" class="mt-3">
                            <p>å½“ä½ éœ€è¦åˆ‡æ¢ä½¿ç”¨å¦å¤–ä¸€ä¸ªæµç¨‹æ—¶ï¼Œä¸éœ€è¦é‡æ–°å¯åŠ¨è„šæœ¬</p>
                            <p>æŒ‰ä¸‹<kbd>F12</kbd>å³å¯è½½å…¥å…¶ä»–æµç¨‹</p>
                            <p>å¿˜è®°äº†ç°åœ¨ç”¨çš„æ˜¯å“ªä¸€ä¸ªæµç¨‹ï¼Ÿ</p>
                            <p>æŒ‰ä¸‹<kbd>F11</kbd>å³å¯æ˜¾ç¤ºå½“å‰è½½å…¥çš„æµç¨‹</p>
                        </el-card>
                        <el-card header="è®¾ç½®å¾ªç¯æ¬¡æ•°" class="mt-3">
                            <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¾ªç¯æ¬¡æ•°æ˜¯æ²¡æœ‰ä¸Šé™çš„ï¼Œå³é‡å¤å¾ªç¯ç›´åˆ°æŒ‰ä¸‹<kbd>F4</kbd>ç»“æŸä¸ºæ­¢</p>
                            <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨<code>missions.txt</code>çš„ç¬¬ä¸€è¡Œæ”¾ä¸Š<code>#å¾ªç¯æ¬¡æ•°</code>æ¥è®¾ç½®ä¸Šé™</p>
                            <p>è®©æˆ‘ä»¬æŠŠä»ä»»åŠ¡æµç¨‹æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡ä¸€éå«åšæ‰§è¡Œä¸€æ¬¡å¾ªç¯</p>
                            <p>å¦‚æœå¾ªç¯ä¸Šé™è¢«è®¾ç½®äº†ï¼Œé‚£ä¹ˆå¾ªç¯ä¼šåœ¨æ¬¡æ•°è¾¾åˆ°ä¸Šé™æ—¶è‡ªåŠ¨ç»“æŸ</p>
                            <p>ä¾‹å¦‚</p>
                            <el-input
                                type="textarea"
                                autosize
                                readonly
                                :value="'#3\n' + example"
                                class="mb-1"
                            >
                            </el-input>
                            <span>ä»£è¡¨</span>
                            <ol>
                                <li>æŒ‰ä¸‹<kbd>Numpad0</kbd>ç­‰å¾…2.5ç§’</li>
                                <li>æŒ‰ä¸‹<kbd>Numpad0</kbd>ç­‰å¾…2.5ç§’</li>
                                <li>æŒ‰ä¸‹<kbd>Numpad0</kbd>ç­‰å¾…2.5ç§’</li>
                                <li>æŒ‰ä¸‹<kbd>1</kbd>ç­‰å¾…40ç§’</li>
                                <li>å›åˆ°æ­¥éª¤1æŒç»­å¾ªç¯ç›´åˆ°å†æ¬¡æŒ‰ä¸‹<kbd>F4</kbd>ç»“æŸæµç¨‹æˆ–è€…æ­¥éª¤1è‡³æ­¥éª¤4è¢«æ‰§è¡Œäº†ä¸‰æ¬¡</li>
                            </ol>
                        </el-card>

                        <el-card header="æ›´æ–°ç¬”è®°" class="mt-3">
                            <!-- <el-timeline>
                                <el-timeline-item
                                    v-for="(log, index) in changelogs"
                                    :key="index"
                                    :timestamp="log.timestamp">
                                    {{log.content}}
                                </el-timeline-item>
                            </el-timeline> -->
                            <el-timeline reverse>
                                <el-timeline-item
                                    v-for="log in changelogs"
                                    :key="log.version"
                                    :timestamp="log.version + ' &bull; ' + log.timestamp"
                                    placement="top"
                                >
                                    <el-alert :closeable="false" type="success">
                                        <template #title v-if="log.features.length">
                                            <ul class="features">
                                                <li v-for="(feature,index) in log.features" :key="index">{{feature}}</li>
                                            </ul>
                                        </template>
                                        <template #default>
                                            <div v-for="text in log.content" :key="text">{{text}}</div>
                                        </template>
                                    </el-alert>
                                </el-timeline-item>
                            </el-timeline>
                        </el-card>
                    </el-main>
                    <el-aside width="200px" style="overflow:inherit!important">
                        <el-menu
                            class="position-sticky"
                            style="top:0"
                            @select="handleSelect"
                            :default-active="index"
                        >
                            <el-menu-item v-for="text in menu" :key="text" :index="text">{{text}}</el-menu-item>
                        </el-menu>
                    </el-aside>
                </el-container>
            </el-container>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
        <script src="https://cdn.jsdelivr.net/npm/element-ui@2.13.2/lib/index.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.20/lodash.min.js"></script>
        <script>
            const createVueApp = ()=>new Vue({
                el: '#app',
                data : {
                    example : `Numpad0|2.5\nNumpad0|2.5\nNumpad0|2.5\n1|40`,
                    menu : [],
                    changelogs : [],
                    current : null
                },
                created () {
                    window.addEventListener('scroll', this.handleScroll);
                },
                destroyed () {
                    window.removeEventListener('scroll', this.handleScroll);
                },
                mounted(){
                    let headers = document.querySelectorAll(".el-card__header")
                    for (let header of headers){
                        let text = header.textContent
                        header.id = text
                        this.menu.push(text)
                    }
                    this.current = this.menu[0]
                    let hash = decodeURIComponent(window.location.hash)
                    if (hash){
                        this.goto(hash.substr(1))
                    }
                    this.parse_changelogs()
                },
                methods : {
                    goto(index){
                        let el = document.getElementById(index)
                        if (el){
                            this.index = index
                            el.scrollIntoView(true)
                        }
                    },
                    handleScroll : _.throttle(function(){
                        let headers = document.querySelectorAll(".el-card__header")
                        for (let header of headers){
                            if(header.getBoundingClientRect().top >= -61){
                                this.index = header.id
                                return
                            }
                        } 
                    },30),
                    handleSelect(index){
                        this.goto(index)
                    },
                    parse_changelogs(){
                        let logs = document.getElementById("changelogs").textContent
                        this.changelogs = _.chain(logs).split("\n\n").map(text=>{
                            let lines = _.chain(text).split("\n").map(line=>_.trim(line)).value()
                            let log = {}
                            log.version = lines.shift()
                            log.timestamp = lines.shift()
                            log.features = []
                            while ( _.size(lines) && lines[0][0] == "-"){
                                log.features.push(_.trim(lines.shift(),"-"))
                            }
                            log.content = lines
                            return log
                        }).value()
                        
                    }
                },
                computed : {
                    index : {
                        get(){
                            return this.current
                        },
                        set(val){
                            if (this.current != val){
                                this.current = val
                                history.replaceState('', '', '#' + val);
                            }
                        }
                    }
                }
            })
            window.addEventListener('load', createVueApp)
        </script>
        <pre id="changelogs" class="d-none">
            1.0.0
            2020/8/20
            æ­£å¼ç‰ˆä¸Šçº¿å•¦ğŸ‰ğŸ‰ğŸ‰

            1.1.0
            2020/8/20
            -å¢åŠ ä»»åŠ¡åˆ—è¡¨åˆ‡æ¢åŠŸèƒ½
            å°†å¿†ï¼šemmmé‚£æ„Ÿè§‰è¿˜æ˜¯ä»¥å‰çš„å®ç”¨ä¸€ç‚¹
            æˆ‘ï¼š_(Â´à½€`ã€ âˆ )_ 

            1.1.1
            2020/8/21
            -å¢åŠ æ›´æ–°ç¬”è®°
            -è§£å†³ä¸­æ–‡ä¹±ç (æŒ‡æ¢å›è‹±æ–‡)
            -ä¿®å¤äº†ä¸€äº›BUG
            è½»è¯­ï¼šæ›´æ–°ç¬”è®°æ¥ä¸€ä¸ª
            æˆ‘ï¼š(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§
        </pre>
    </body>
</html>